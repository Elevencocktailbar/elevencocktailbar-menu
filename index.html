<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu - Eleven Cocktail Bar</title>
  <style>
    :root {
      --bg:#0f0f10;
      --card:#17181a;
      --line:#2a2c2f;
      --txt:#f4f5f7;
      --muted:#b9bcc3;
      --btn:#f6bf1a;       /* giallo stile screenshot */
      --btnText:#111;
      --btnShadow: 0 8px 18px rgba(0,0,0,.25);
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin:0;
      background:var(--bg);
      color:var(--txt);
    }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }

    /* Sticky top area: title + categories stay fixed while scrolling items */
    .stickyTop {
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--bg);
      padding-top: 18px;
      padding-bottom: 12px;
      /* Extend background full width of the padded container */
      margin: -18px -18px 0;
      padding-left: 18px;
      padding-right: 18px;
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
    }

    header { display:flex; align-items:baseline; justify-content:space-between; gap:12px; margin-bottom: 14px; }
    h1 { font-size: 26px; margin: 0; letter-spacing: .2px; }
    .stamp { font-size: 12px; color: var(--muted); }

    /* Views */
    .hidden { display:none !important; }

    /* Category buttons layout: like the original site
       - single buttons (no accordion)
       - max 3 per row, wrapping based on label length
       - SAME behavior on mobile and desktop (no forced single column) */
    .cat-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px;
      margin-top: 10px;
    }

    .cat-btn {
      appearance: none;
      border: 0;
      border-radius: 18px;
      padding: 14px 18px;
      background: var(--btn);
      color: var(--btnText);
      font-weight: 900;
      letter-spacing: .3px;
      text-transform: uppercase;
      box-shadow: var(--btnShadow);
      cursor: pointer;
      line-height: 1.15;
      white-space: nowrap;
      font-size: clamp(13px, 2.2vw, 18px);

      /* Key: at most 3 per row */
      flex: 1 1 calc((100% - 28px) / 3);
      max-width: calc((100% - 28px) / 3);
      min-width: 110px;
    }
    /* Tiny screens: allow 2 per row if 3 would overflow */
    @media (max-width: 360px) {
      .cat-btn { flex-basis: calc((100% - 14px) / 2); max-width: calc((100% - 14px) / 2); }
    }
    .cat-btn:active { transform: translateY(1px); }
    .cat-btn.active {
      /* subtle highlight for the selected category */
      box-shadow: var(--btnShadow), 0 0 0 3px rgba(246,191,26,.35);
    }
    .cat-btn.active {
      box-shadow: var(--btnShadow), 0 0 0 3px rgba(246,191,26,.35) inset;
    }

    /* Items list */
    .backbar { display:flex; align-items:center; gap:10px; margin-top: 6px; }
    .back-btn {
      border: 1px solid var(--line);
      background: transparent;
      color: var(--txt);
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
    }
    .cat-title { font-weight: 900; letter-spacing: .2px; }

    .items-card { background: var(--card); border: 1px solid var(--line); border-radius: 14px; overflow:hidden; margin-top: 12px; }
    .item { display:flex; justify-content:space-between; gap:14px; padding: 12px 14px; border-top: 1px solid #24262a; }
    .item:first-child { border-top: 0; }
    .left { min-width: 0; }
    .name { font-weight: 900; }
    .recipe { color: var(--muted); margin-top: 4px; line-height: 1.35; }
    .price { white-space: nowrap; font-weight: 900; }

    @media (max-width: 520px) {
      .item { flex-direction: column; }
      .price { align-self: flex-start; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="stickyTop">
      <header>
        <h1>Menu</h1>
        <div class="stamp" id="stamp"></div>
      </header>

      <div id="viewCategories"></div>
      <div id="subbar" class="hidden"></div>
    </div>

    <div id="viewItems" class="hidden"></div>
  </div>

  <script>
    const DATA_URL = 'menu_online.json';

    const viewCategories = document.getElementById('viewCategories');
    const viewItems = document.getElementById('viewItems');
    const subbar = document.getElementById('subbar');
    const stamp = document.getElementById('stamp');

    let CURRENT_MENU = null;
    let selectedIdx = null;

    function euro(v) {
      if (v === null || v === undefined || v === '') return '';
      const n = Number(v);
      if (Number.isNaN(n)) return String(v);
      return n.toFixed(n % 1 === 0 ? 0 : 2).replace('.', ',') + ' €';
    }

    function updateActiveButtons() {
      const buttons = viewCategories.querySelectorAll('.cat-btn');
      buttons.forEach((b, i) => {
        if (selectedIdx === i) b.classList.add('active');
        else b.classList.remove('active');
      });
    }

    function clearSelection() {
      selectedIdx = null;
      updateActiveButtons();
      subbar.classList.add('hidden');
      subbar.innerHTML = '';
      viewItems.classList.add('hidden');
      viewItems.innerHTML = '';
      window.scrollTo({ top: 0, behavior: 'instant' });
    }

    function renderSubbar(MENU, idx) {
      const cat = MENU.categories[idx];
      if (!cat) return;

      subbar.innerHTML = '';
      const bar = document.createElement('div');
      bar.className = 'backbar';

      const back = document.createElement('button');
      back.className = 'back-btn';
      back.type = 'button';
      back.textContent = '← Categorie';
      back.addEventListener('click', clearSelection);

      const title = document.createElement('div');
      title.className = 'cat-title';
      title.textContent = cat.name;

      bar.appendChild(back);
      bar.appendChild(title);
      subbar.appendChild(bar);
      subbar.classList.remove('hidden');
    }

    function renderItems(MENU, idx) {
      const cat = MENU.categories[idx];
      if (!cat) return;

      viewItems.innerHTML = '';

      const card = document.createElement('div');
      card.className = 'items-card';

      (cat.items || []).forEach((it) => {
        const row = document.createElement('div');
        row.className = 'item';

        const left = document.createElement('div');
        left.className = 'left';

        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = it.name;
        left.appendChild(name);

        if (it.ingredients) {
          const r = document.createElement('div');
          r.className = 'recipe';
          r.textContent = it.ingredients;
          left.appendChild(r);
        }

        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = euro(it.price);

        row.appendChild(left);
        row.appendChild(price);
        card.appendChild(row);
      });

      viewItems.appendChild(card);
      viewItems.classList.remove('hidden');
    }

    function renderCategories(MENU) {
      CURRENT_MENU = MENU;
      stamp.textContent = MENU?.generated_at ? ('Aggiornato: ' + MENU.generated_at.replace('T',' ')) : '';

      if (!MENU?.categories || !MENU.categories.length) {
        viewCategories.innerHTML = '<p style="color:#b9bcc3">Nessun prodotto online.</p>';
        clearSelection();
        return;
      }

      viewCategories.innerHTML = '';

      const grid = document.createElement('div');
      grid.className = 'cat-grid';

      MENU.categories.forEach((cat, idx) => {
        const b = document.createElement('button');
        b.className = 'cat-btn';
        b.type = 'button';
        b.textContent = cat.name;
        b.addEventListener('click', () => showCategory(MENU, idx));
        grid.appendChild(b);
      });

      viewCategories.appendChild(grid);
      updateActiveButtons();

      // If a category was already selected (e.g. back/forward), re-render items
      if (selectedIdx !== null && MENU.categories[selectedIdx]) {
        renderSubbar(MENU, selectedIdx);
        renderItems(MENU, selectedIdx);
      } else {
        subbar.classList.add('hidden');
        viewItems.classList.add('hidden');
      }
    }

    function showCategory(MENU, idx) {
      selectedIdx = idx;
      updateActiveButtons();
      renderSubbar(MENU, idx);
      renderItems(MENU, idx);
      window.scrollTo({ top: 0, behavior: 'instant' });
    }

    async function loadAndRender() {
      try {
        const bust = Date.now();
        const resp = await fetch(`${DATA_URL}?v=${bust}`, {
          cache: 'no-store',
          headers: { 'Cache-Control': 'no-cache' },
        });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const MENU = await resp.json();
        renderCategories(MENU);
      } catch (e) {
        viewCategories.innerHTML = '<p style="color:#b9bcc3">Errore nel caricamento del menu. Riprova tra poco.</p>';
      }
    }

    loadAndRender();
  </script>
</body>
</html>
