<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Menu - Eleven Cocktail Bar</title>

  <style>
    :root{
      --bg:#0f0f10;
      --card:#17181a;
      --line:#2a2c2f;
      --txt:#f4f5f7;
      --muted:#b9bcc3;
      --btn:#f6bf1a;
      --btnText:#111;
      --btnShadow:0 8px 18px rgba(0,0,0,.25);
    }

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--txt);
      padding-bottom:env(safe-area-inset-bottom);
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:16px;
    }

    /* ===== STICKY TOP ===== */
    .stickyTop{
      position:sticky;
      top:0;
      z-index:50;
      background:var(--bg);
      margin:-16px -16px 0;
      padding:12px 16px 10px;
      box-shadow:0 8px 18px rgba(0,0,0,.35);
      max-height:52dvh;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:8px;
      margin-bottom:8px;
    }

    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }

    .stamp{
      font-size:11px;
      color:var(--muted);
    }

    .hidden{display:none!important;}

    /* ===== CATEGORIE ===== */
    .cat-grid{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }

    .cat-btn{
      flex:1 1 calc((100% - 20px)/3);
      max-width:calc((100% - 20px)/3);
      min-width:0;

      border:0;
      border-radius:14px;
      padding:8px 6px;

      background:var(--btn);
      color:var(--btnText);
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.3px;
      box-shadow:var(--btnShadow);
      cursor:pointer;

      font-size:11px;
      line-height:1.05;
      text-align:center;

      white-space:normal;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      min-height:42px;
    }

    .cat-btn.active{
      box-shadow:var(--btnShadow),0 0 0 3px rgba(246,191,26,.35) inset;
    }

    /* ===== SUBBAR ===== */
    .backbar{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:6px;
    }

    .back-btn{
      border:1px solid var(--line);
      background:transparent;
      color:var(--txt);
      padding:7px 9px;
      border-radius:11px;
      cursor:pointer;
    }

    .cat-title{
      font-weight:900;
      font-size:16px;
    }

    /* ===== PRODOTTI ===== */
    .items-card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      margin-top:8px;
      overflow:hidden;
    }

    .item{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border-top:1px solid #24262a;
    }

    .item:first-child{border-top:0;}

    .left{min-width:0;}

    .name{
      font-weight:900;
      font-size:15px;
    }

    .recipe{
      color:var(--muted);
      font-size:13px;
      margin-top:4px;
      line-height:1.3;
    }

    .price{
      white-space:nowrap;
      font-weight:900;
      font-size:15px;
    }

    @media(max-width:520px){
      .item{flex-direction:column;}
      .price{align-self:flex-start;}
    }

    :root{scroll-padding-top:120px;}
  </style>
</head>

<body>

  <!-- BADGE TEST: se NON lo vedi, Freedom Builder non usa questo file -->
  <div style="position:fixed;right:8px;bottom:8px;z-index:9999;
              background:#00d26a;color:#111;
              font:700 12px/1 system-ui;
              padding:6px 8px;border-radius:10px;
              box-shadow:0 6px 14px rgba(0,0,0,.35)">
    TEST v1
  </div>

  <div class="wrap">
    <div class="stickyTop">
      <header>
        <h1>Menu</h1>
        <div class="stamp" id="stamp"></div>
      </header>

      <div id="viewCategories"></div>
      <div id="subbar" class="hidden"></div>
    </div>

    <div id="viewItems" class="hidden"></div>
  </div>

  <script>
    const DATA_URL = 'menu_online.json';

    const viewCategories = document.getElementById('viewCategories');
    const viewItems = document.getElementById('viewItems');
    const subbar = document.getElementById('subbar');
    const stamp = document.getElementById('stamp');

    let selectedIdx = null;

    function euro(v){
      if(v===null||v===undefined||v==='')return '';
      const n=Number(v);
      if(Number.isNaN(n))return String(v);
      return n.toFixed(n%1===0?0:2).replace('.',',')+' €';
    }

    function updateActiveButtons(){
      document.querySelectorAll('.cat-btn').forEach((b,i)=>{
        b.classList.toggle('active',selectedIdx===i);
      });
    }

    function clearSelection(){
      selectedIdx=null;
      updateActiveButtons();
      subbar.classList.add('hidden');
      viewItems.classList.add('hidden');
      viewItems.innerHTML='';
      window.scrollTo({top:0,behavior:'instant'});
    }

    function renderSubbar(MENU,idx){
      const cat=MENU.categories[idx];
      subbar.innerHTML='';
      const bar=document.createElement('div');
      bar.className='backbar';

      const back=document.createElement('button');
      back.className='back-btn';
      back.textContent='← Categorie';
      back.onclick=clearSelection;

      const title=document.createElement('div');
      title.className='cat-title';
      title.textContent=cat.name;

      bar.append(back,title);
      subbar.appendChild(bar);
      subbar.classList.remove('hidden');
    }

    function renderItems(MENU,idx){
      const cat=MENU.categories[idx];
      viewItems.innerHTML='';
      const card=document.createElement('div');
      card.className='items-card';

      (cat.items||[]).forEach(it=>{
        const row=document.createElement('div');
        row.className='item';

        const left=document.createElement('div');
        left.className='left';

        const name=document.createElement('div');
        name.className='name';
        name.textContent=it.name;
        left.appendChild(name);

        if(it.ingredients){
          const r=document.createElement('div');
          r.className='recipe';
          r.textContent=it.ingredients;
          left.appendChild(r);
        }

        const price=document.createElement('div');
        price.className='price';
        price.textContent=euro(it.price);

        row.append(left,price);
        card.appendChild(row);
      });

      viewItems.appendChild(card);
      viewItems.classList.remove('hidden');
    }

    function renderCategories(MENU){
      stamp.textContent=MENU.generated_at?('Aggiornato: '+MENU.generated_at.replace('T',' ')):'';
      viewCategories.innerHTML='';
      const grid=document.createElement('div');
      grid.className='cat-grid';

      MENU.categories.forEach((cat,idx)=>{
        const b=document.createElement('button');
        b.className='cat-btn';
        b.textContent=cat.name;
        b.onclick=()=>{
          selectedIdx=idx;
          updateActiveButtons();
          renderSubbar(MENU,idx);
          renderItems(MENU,idx);
          window.scrollTo({top:0,behavior:'instant'});
        };
        grid.appendChild(b);
      });

      viewCategories.appendChild(grid);
    }

    async function load(){
      const r=await fetch(DATA_URL+'?v='+Date.now(),{cache:'no-store'});
      const MENU=await r.json();
      renderCategories(MENU);
    }

    load();
  </script>
</body>
</html>
